<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chessboard with Piece Images</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone@7.10.3/babel.min.js" crossorigin></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    #root {
      width: 100%;
      height: 100%;
    }

    .full-background {
      background-image: url('https://github.com/sueskm578/sueskm578.github.io/raw/main/React/Logo%202%20Chess.jpg');
      background-size: cover;
      background-position: center;
      height: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      position: relative;
    }

    .centered {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }

    .chessboard-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background-color: #333;
      padding: 20px;
      border-radius: 10px;
    }

    .start-button {
      position: absolute;
      right: 50px;
      bottom: 50px;
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      background-color: rgba(255, 255, 255, 0.7);
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .start-button:hover {
      background-color: rgba(255, 255, 255, 1);
    }

    .black-background {
      background-color: black;
    }

    .game-over {
      color: white;
      font-size: 24px;
      margin-top: 20px;
    }

    .promotion-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .promotion-button {
      margin: 0 5px;
      padding: 10px;
      cursor: pointer;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react,stage-3">
    const initialGameState = [
      ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
      ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
      ['', '', '', '', '', '', '', ''],
      ['', '', '', '', '', '', '', ''],
      ['', '', '', '', '', '', '', ''],
      ['', '', '', '', '', '', '', ''],
      ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
      ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
    ];

    const pieceImages = {
      'r': 'https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt45.svg',
      'n': 'https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt45.svg',
      'b': 'https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt45.svg',
      'q': 'https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt45.svg',
      'k': 'https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt45.svg',
      'p': 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt45.svg',
      'R': 'https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt45.svg',
      'N': 'https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt45.svg',
      'B': 'https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt45.svg',
      'Q': 'https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt45.svg',
      'K': 'https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt45.svg',
      'P': 'https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg'
    };

    // Replace with the URLs of your sound files
    const moveSound = new Audio("https://github.com/sueskm578/sueskm578.github.io/raw/main/React/ChessMove.wav");
    const captureSound = new Audio("https://github.com/sueskm578/sueskm578.github.io/raw/main/React/Chesscapture.mp3");
    const gameOverSound = new Audio("https://github.com/sueskm578/sueskm578.github.io/raw/main/React/Chessgameover.mp3");
    const backgroundMusic = new Audio("https://github.com/sueskm578/sueskm578.github.io/raw/main/React/ChessBackgroundmusic.mp3");

    function Game() {
      const [game, setGame] = React.useState(initialGameState);
      const [selectedSquare, setSelectedSquare] = React.useState(null);
      const [gameStarted, setGameStarted] = React.useState(false);
      const [gameOver, setGameOver] = React.useState(false);
      const [winner, setWinner] = React.useState(null);
      const [promotionSquare, setPromotionSquare] = React.useState(null);
      const [promotionChoice, setPromotionChoice] = React.useState(null);

      function checkGameStatus(newGame) {
        const whiteInCheck = isInCheck(newGame, 'K');
        const blackInCheck = isInCheck(newGame, 'k');

        if (whiteInCheck && !canMove(newGame, 'K')) {
          setGameOver(true);
          gameOverSound.play();
          setWinner('Black');
        } else if (blackInCheck && !canMove(newGame, 'k')) {
          setGameOver(true);
          gameOverSound.play();
          setWinner('White');
        } else if (!whiteInCheck && !canMove(newGame, 'K') && !blackInCheck) {
          setGameOver(true);
          gameOverSound.play();
          setWinner('Stalemate');
        }
      }

      function isInCheck(newGame, king) {
        // Check if the king is in check
        const kingPosition = findKingPosition(newGame, king);
        for (let row = 0; row < 8; row++) {
          for (let col = 0; col < 8; col++) {
            const piece = newGame[row][col];
            if (piece && piece.toLowerCase() !== king.toLowerCase()) {
              if (isValidMove(newGame, piece, row, col, kingPosition[0], kingPosition[1])) {
                return true; // King is in check
              }
            }
          }
        }
        return false; // King is safe
      }

      function findKingPosition(newGame, king) {
        for (let row = 0; row < 8; row++) {
          for (let col = 0; col < 8; col++) {
            if (newGame[row][col] === king) {
              return [row, col];
            }
          }
        }
        return null;
      }

      function canMove(newGame, king) {
        const kingPosition = findKingPosition(newGame, king);
        if (!kingPosition) return false;

        for (let row = 0; row < 8; row++) {
          for (let col = 0; col < 8; col++) {
            const piece = newGame[row][col];
            if (piece && piece.toLowerCase() !== king.toLowerCase()) {
              if (isValidMove(newGame, piece, row, col, kingPosition[0], kingPosition[1])) {
                return true; // There is a valid move
              }
            }
          }
        }
        return false; // No valid moves
      }

      function isValidMove(game, piece, fromRow, fromCol, toRow, toCol) {
        // Basic piece movement validation (simplified)
        const pieceType = piece.toLowerCase();
        const direction = piece === piece.toUpperCase() ? 1 : -1;

        // Add more detailed movement rules for each piece type...
        switch (pieceType) {
          case 'p':
            return (toCol === fromCol && toRow === fromRow + direction && !game[toRow][toCol]) || // Move forward
                   (toCol === fromCol && toRow === fromRow + 2 * direction && fromRow === (piece === 'p' ? 1 : 6) && !game[toRow][toCol] && !game[fromRow + direction][toCol]) || // Double move
                   (Math.abs(toCol - fromCol) === 1 && toRow === fromRow + direction && game[toRow][toCol] && game[toRow][toCol].toLowerCase() !== pieceType); // Capture
          case 'r':
            return (fromRow === toRow || fromCol === toCol) && clearPath(game, fromRow, fromCol, toRow, toCol);
          case 'n':
            return (Math.abs(fromRow - toRow) === 2 && Math.abs(fromCol - toCol) === 1) || (Math.abs(fromRow - toRow) === 1 && Math.abs(fromCol - toCol) === 2);
          case 'b':
            return Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol) && clearPath(game, fromRow, fromCol, toRow, toCol);
          case 'q':
            return (fromRow === toRow || fromCol === toCol || Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol)) && clearPath(game, fromRow, fromCol, toRow, toCol);
          case 'k':
            return (Math.abs(fromRow - toRow) <= 1 && Math.abs(fromCol - toCol) <= 1);
          default:
            return false;
        }
      }

      function clearPath(game, fromRow, fromCol, toRow, toCol) {
        const rowStep = (toRow - fromRow) === 0 ? 0 : (toRow - fromRow) > 0 ? 1 : -1;
        const colStep = (toCol - fromCol) === 0 ? 0 : (toCol - fromCol) > 0 ? 1 : -1;

        let row = fromRow + rowStep;
        let col = fromCol + colStep;

        while (row !== toRow || col !== toCol) {
          if (game[row][col]) return false; // Path is blocked
          row += rowStep;
          col += colStep;
        }
        return true; // Path is clear
      }

      function handleClick(row, col) {
        if (gameOver) return;

        if (promotionSquare) {
          // Handle pawn promotion
          const newGame = game.map(row => row.slice());
          newGame[promotionSquare[0]][promotionSquare[1]] = promotionChoice;
          setGame(newGame);
          setPromotionSquare(null);
          setPromotionChoice(null);
          checkGameStatus(newGame);
          return;
        }

        if (selectedSquare) {
          const newGame = game.map(row => row.slice());
          const [selectedRow, selectedCol] = selectedSquare;

          const movedPiece = newGame[selectedRow][selectedCol];
          const capturedPiece = newGame[row][col];

          // Castling logic
          if (movedPiece.toLowerCase() === 'k' && Math.abs(col - selectedCol) === 2) {
            if (col === 6) { // kingside castling
              newGame[row][col - 1] = newGame[row][7]; // move rook
              newGame[row][7] = ''; // empty rook's square
            } else if (col === 2) { // queenside castling
              newGame[row][col + 1] = newGame[row][0]; // move rook
              newGame[row][0] = ''; // empty rook's square
            }
          }

          newGame[row][col] = movedPiece;
          newGame[selectedRow][selectedCol] = '';

          if (capturedPiece) {
            captureSound.play();
          } else {
            moveSound.play();
          }

          // Handle pawn promotion
          if (movedPiece.toLowerCase() === 'p' && row === 0) {
            setPromotionSquare([row, col]);
            return; // wait for promotion choice
          }

          setGame(newGame);
          setSelectedSquare(null);
          checkGameStatus(newGame);
        } else {
          // Select square
          setSelectedSquare([row, col]);
        }
      }

      function handlePromotion(choice) {
        setPromotionChoice(choice);
      }

      function handleStart() {
        setGame(initialGameState);
        setGameStarted(true);
        setGameOver(false);
        setWinner(null);
        setSelectedSquare(null);
        setPromotionSquare(null);
        setPromotionChoice(null);
        backgroundMusic.play();
      }

      return (
        <div className="full-background">
          <div className="centered">
            <div className="chessboard-container">
              {game.map((row, rowIndex) => (
                <div key={rowIndex} style={{ display: 'flex' }}>
                  {row.map((piece, colIndex) => (
                    <div
                      key={colIndex}
                      style={{
                        width: '60px',
                        height: '60px',
                        backgroundColor: (rowIndex + colIndex) % 2 === 0 ? '#fff' : '#ccc',
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleClick(rowIndex, colIndex)}
                    >
                      {piece && <img src={pieceImages[piece]} alt={piece} style={{ width: '50px', height: '50px' }} />}
                    </div>
                  ))}
                </div>
              ))}
              {promotionSquare && (
                <div className="promotion-container">
                  <span>Select promotion: </span>
                  {['Q', 'R', 'B', 'N'].map(choice => (
                    <button key={choice} className="promotion-button" onClick={() => handlePromotion(choice)}>
                      {choice}
                    </button>
                  ))}
                </div>
              )}
              {gameOver && <div className="game-over">{winner === 'Stalemate' ? 'Game Over: Stalemate!' : `Game Over: ${winner} Wins!`}</div>}
            </div>
            <button className="start-button" onClick={handleStart}>Start Game</button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<Game />, document.getElementById('root'));
  </script>
</body>
</html>
